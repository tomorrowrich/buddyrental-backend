#!/bin/sh
pnpm prisma generate

echo "ğŸ” Running pre-commit checks..."

echo "ğŸ“Š Checking for pending Prisma migrations..."
if ! pnpm prisma migrate status ; then
  echo "âŒ Error: There are pending Prisma migrations."
  echo "ğŸ‘‰ Please run 'pnpm prisma migrate deploy' to apply pending migrations."
  exit 1
fi
echo "âœ… No pending migrations found."

echo "ğŸ”„ Checking for schema changes..."
if ! pnpm prisma migrate diff --from-schema-datamodel prisma/schema.prisma --to-schema-datasource prisma/schema.prisma --exit-code ; then
  echo "âŒ Error: Your schema.prisma has uncommitted changes."
  echo "ğŸ‘‰ Please run 'pnpm prisma migrate dev' to create a new migration."
  exit 1
fi
echo "âœ… Schema is up to date."

echo "ğŸƒ Running tests..."
pnpm test

echo "âœ¨ Formatting code..."
pnpm format

echo "ğŸ” Running linter..."
pnpm lint

echo "âœ… All pre-commit checks passed successfully!"

